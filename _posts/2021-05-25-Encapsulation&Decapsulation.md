---
layout: post
title: "[네트워크] 인캡슐레이션과 디캡슐레이션"
subtitle: "IT 엔지니어를 위한 네트워크 입문"
date: 2021-05-25 7:55:00 +0900
background: '/img/posts/cable.jpg'
category: Study
tags: [network]
---
### 1.5 인캡슐레이션과 디캡슐레이션
상위 계층에서 하위 계층으로 데이터를 보내면 물리 계층에서 전기 신호 형태로 네트워크를 통해 신호를 보냅니다. 이 과정을 **인캡슐레이션**이라 합니다.

보낸 신호를 받는 쪽에서 다시 하위 계층에서 상위 계층으로 데이터를 보냅니다. 이 과정을 **디캡슐레이션**이라 합니다.

<img class="img-fluid" src="/img/posts/inPost/capsulation-01.png">

*****

현대 네트워크는 패킷 기반으로 데이터를 작은 단위로 쪼개 보냅니다. 이런 기법으로 하나의 통신이 회선 전첼를 점유하지 않고 동시에 여러 단말이 통신하도록 해줍니다.

데이터를 패킷으로 쪼개고 네트워크를 이용해 목적지로 보내고 받는 쪽에서는 패킷을 다시 큰 데이터 형태로 결합해 사용합니다.

##### 인캡슐레이션
애플리케이션에서 데이터를 데이터 플로 계층으로 내려보내면서 패킷에 데이터를 넣을 수 있도록 분할하는 과정
* 네트워크 상황을 고려해 적절한 크기로 데이터를 쪼개고, 4계층부터 네트워크 전송을 위한 정보를 헤더에 붙여넣습니다.
* 4, 3, 2계층에서 각각 필요한 헤더를 추가해 데이터 플로 계층에서만 3개의  헤더 정보가 추가됩니다.

##### 디캡슐레이션
받는 쪽에서 디캡슐레이션 과정을 수행합니다.
1. 받은 전기 신호를 데이터 형태로 만들어 2계층으로 올려보냅니다.
2. 2계층에서는 송신자가 작성한 2계층 헤더에 포함된 정보를 확인합니다.
    * 만약 정보 중 목적지가 자신이 아니라면 자신에게 온 패킷이 아니므로 버립니다.
    * 이 부분은 랜 카드가 담당합니다.
3. 목적지가 자신이 맞다면 3계층으로 이 정보를 보냅니다. 이때 2계층의 헤더 정보는 더 이상 필요없으므로 벗겨내고 올려보내 줍니다.
4. 이 데이터를 받은 3계층에서는 2계층이 동작했던 것처럼 상대방이 적은 3계층의 헤더 정보를 확인해 자신에게 온 것이 맞는지 확인하고, 맞다면 헤더를 벗겨내 4계층으로 보냅니다.
5. 이를 받은 4계층도 3계층과 같은 과정을 거쳐 애플리케이션에 데이터를 올려보내 줍니다.

이렇게 복잡한 데이터 전달 과정을 두 가지 정보 흐름으로 정리하면 다음과 같습니다.
* 인캡슐레이션, 디캡슐레이션 과정을 통해 데이터가 전송되는 과정
* 각 계층 헤더를 이용해 송신자 계층과 수신자 계층 간의 논리적 통신 과정

만약 4계층에서 헤더를 추가했다면 그 정보는 받는 쪽의 4계층에서 확인합니다. 중간에 적힌 헤터 정보는 받는 계층에서 참고하고 버립니다.

정리하면 실제 데이터는 상위 계층 -> 하위 계층, 하위 계층 -> 상위 계층으로 전달되고 헤더 정보는 각 계층끼리 전달됩니다.

### 헤더에 포함될 정보들
인캡슐레이션 과정에서 헤더에 넣는 정보들이 꽤 많아 모두 이해하기 힘들며 프로토콜마다 특성이 달라 적어 넣는 정보가 다르므로 이 정보를 모두 이해하려면 많은 공부가 필요합니다.

하지만 이런 복잡한 정보들에도 규칙이 있으며 헤더에 두 가지 정보는 반드시 포함되어야 합니다.

1. 현재 계층에서 정의하는 정보
2. 상위 프로토콜 지시자